import{j as e}from"./mui-vendor-Ch3u1txE.js";import{r as t}from"./react-vendor-CYnrZ62f.js";import{a}from"./index-z-z7bop-.js";/* empty css                      */import"./utils-Bon0u5qF.js";const i="/assets/document_icon-BZvRvaMc.png",s=({file:a,onDownload:s,onDelete:l})=>{const[r,o]=t.useState(!1),n=e=>{switch(e){case"audio":return"/assets/audio_icon-CiV3SH9f.png";case"image":return"/assets/image_icon-qFbkZ0C7.png";case"document":default:return i;case"video":return"/assets/video_icon-DdTKAfKn.png"}};return e.jsxs("div",{className:"file-card border-2 shadow-md rounded-lg hover:shadow-lg transition-shadow duration-300 bg-gradient-to-r from-gray-50 to-gray-100 relative",children:[e.jsx("button",{onClick:()=>l(a),className:"delete-button absolute top-2 right-2 text-red-500 hover:text-red-700","aria-label":"Delete File",style:{fontSize:"12px"},children:"âœ–"}),e.jsxs("div",{className:"file-info flex items-start space-x-4 p-4",children:[e.jsx("div",{className:"flex-shrink-0",children:(()=>{const t={width:"120px",height:"120px",objectFit:"cover",borderRadius:"8px",backgroundColor:"#f3f4f6",display:"flex",alignItems:"center",justifyContent:"center"};return"image"!==a.type||r?e.jsx("div",{style:t,children:e.jsx("img",{src:n(a.type),alt:a.type,style:{width:"60px",height:"60px",padding:"8px"}})}):e.jsx("div",{style:t,children:e.jsx("img",{src:a.file_url||a.file,alt:a.title,style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"8px"},onError:()=>{o(!0)}})})})()}),e.jsxs("div",{className:"flex-grow min-w-0",children:[e.jsx("div",{className:"max-h-24 overflow-y-auto pr-2 custom-scrollbar",children:e.jsx("h3",{className:"text-xl font-semibold text-gray-800 break-words",children:a.title})}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[a.type," | ",(e=>{if(!e)return"Date not available";try{const t=new Date(e);if(isNaN(t.getTime()))return"Invalid date";return new Intl.DateTimeFormat("en-GB",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}).format(t)}catch(t){return"Invalid date"}})(a.uploaded_at)]})]})]}),e.jsxs("div",{className:"file-actions p-4 flex justify-between items-center border-t border-gray-200",children:[e.jsxs("span",{className:"text-sm text-blue-400 truncate max-w-[50%]",children:["Sender: ",(e=>{if(!e)return"Unknown";try{const{first_name:t,last_name:a}=e;return t&&a?`${t} ${a}`:t||(a||(e.username||"Unknown"))}catch(t){return"Unknown"}})(a.sender)]}),e.jsx("button",{onClick:s,className:"download-button text-blue-600 bg-blue-100 border border-blue-300 hover:bg-blue-200 transition-colors duration-200 font-semibold px-4 py-2 rounded",children:"Download"})]})]})},l=({filters:t,setFilters:a})=>e.jsxs("div",{className:"file-filter-panel mt-8",children:[e.jsxs("select",{value:t.type,onChange:e=>a((t=>({...t,type:e.target.value}))),children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"document",children:"Documents"}),e.jsx("option",{value:"image",children:"Images"}),e.jsx("option",{value:"audio",children:"Audio"})]}),e.jsx("input",{type:"text",placeholder:"Search by title...",value:t.searchTerm,onChange:e=>a((t=>({...t,searchTerm:e.target.value})))})]}),r=({src:i,userName:s,className:l=""})=>{const[r,o]=t.useState(!1),[n,d]=t.useState(!0),c=(null==i?void 0:i.includes("#preview"))?i.replace("#preview",""):(null==i?void 0:i.startsWith("http"))?i:i?`${a.defaults.baseURL}${i}`:null;return t.useEffect((()=>{if(o(!1),d(!0),!c)return o(!0),void d(!1);const e=new Image;return e.onload=()=>{d(!1),o(!1)},e.onerror=e=>{o(!0),d(!1)},e.src=c,()=>{e.onload=null,e.onerror=null,(null==i?void 0:i.includes("#preview"))&&URL.revokeObjectURL(c)}}),[c,i]),r||!c?e.jsx("div",{className:`w-full h-full rounded-full bg-gradient-to-br from-blue-100 to-blue-200 flex items-center justify-center text-blue-500 border-4 border-white shadow-xl ${l}`,children:e.jsx("svg",{className:"w-12 h-12",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}):e.jsxs("div",{className:"relative w-full h-full",children:[n&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 rounded-full",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}),e.jsx("img",{src:c,alt:`${s}'s profile`,className:`w-full h-full rounded-full object-cover border-4 border-white shadow-xl ${n?"opacity-0":"opacity-100"} transition-opacity duration-300 ${l}`,onError:()=>o(!0)})]})},o=()=>{t.useEffect((()=>{window.scrollTo(0,0)}),[]);const[i,o]=t.useState([]),[n,d]=t.useState([]),[c,u]=t.useState({type:"all",searchTerm:""}),[m,f]=t.useState([]),[p,h]=t.useState(null);t.useState("document");const[v,x]=t.useState(""),[g,b]=t.useState(null),[y,w]=t.useState(null),[j,N]=t.useState(""),[_,k]=t.useState(0),[$,S]=t.useState(!1),C=()=>{const e=document.cookie.split(";");for(let t of e)if(t=t.trim(),t.startsWith("csrftoken="))return t.substring(10);return null},D=async()=>{var e,t,i,s;if(g)try{const l=`/files/private/all-files/${g}/`,r=await a.get(l),n=e=>{var t;return e.file_url||((null==(t=e.file)?void 0:t.startsWith("http"))?e.file:`${a.defaults.baseURL}${e.file}`)},c=[...(null==(e=r.data.private_documents)?void 0:e.map((e=>({...e,type:"document",file_url:n(e)}))))||[],...(null==(t=r.data.private_images)?void 0:t.map((e=>({...e,type:"image",file_url:n(e)}))))||[],...(null==(i=r.data.private_audio)?void 0:i.map((e=>({...e,type:"audio",file_url:n(e)}))))||[],...(null==(s=r.data.private_videos)?void 0:s.map((e=>({...e,type:"video",file_url:n(e)}))))||[]];o(c),d(c)}catch(l){}};t.useEffect((()=>{(async()=>{try{const e=await a.get("/users/me/");if(200===e.status){const t=e.data;t.profile_picture_url&&(t.profile_picture=t.profile_picture_url),w(t),"teacher"===t.user_type&&(b(t.id),N(`${t.first_name} ${t.last_name}`))}}catch(e){}})()}),[]),t.useEffect((()=>{y&&(async()=>{try{const e=(await a.get("/files/students/list/",{headers:{"X-CSRFToken":C()},credentials:"include"})).data.filter((e=>e&&e.id&&e.first_name&&e.last_name));if(f(e),e.length>0&&y&&"teacher"!==y.user_type){const t=e[0];b(t.id),N(`${t.first_name} ${t.last_name}`)}}catch(e){}})()}),[y]),t.useEffect((()=>{D()}),[g]),t.useEffect((()=>{let e=[...i];"all"!==c.type&&(e=e.filter((e=>e.type===c.type))),c.searchTerm&&(e=e.filter((e=>e.title.toLowerCase().includes(c.searchTerm.toLowerCase())))),d(e)}),[c,i]);const F=async e=>{if(e.preventDefault(),!p)return void alert("Please select a file to upload.");if(!v.trim())return void alert("Please provide a title for the file.");const t=p.size/1048576,i=p.name.split(".").pop().toLowerCase(),s=p.type;let l,r;const n={audio:["mp3","wav","ogg","aac","m4a","wma"],video:["mp4","webm","avi","mov","mkv","wmv","mpeg"],image:["jpg","jpeg","png","gif","webp","svg"],document:["pdf","doc","docx","txt","rtf","odt"]};if(s.startsWith("audio/")||n.audio.includes(i))l="audio",r=30;else if(s.startsWith("video/")||n.video.includes(i))l="video",r=100;else if(s.startsWith("image/")||n.image.includes(i))l="image",r=10;else{if(!(s.startsWith("application/pdf")||s.startsWith("application/msword")||s.startsWith("application/vnd.openxmlformats-officedocument")||s.startsWith("text/")||n.document.includes(i)))return void alert("Unsupported file type. Please upload a document, image, audio, or video file.");l="document",r=50}if(t>r)return void alert(`File size exceeds the ${r}MB limit for ${l} files. Your file is ${t.toFixed(2)}MB.`);const d=new FormData;d.append("file",p),d.append("title",v),d.append("fileType",l),d.append("originalExtension",i);try{S(!0),k(0);const e=`/files/private/all-files/${g||"default"}/`,t=await a.post(e,d,{headers:{"Content-Type":"multipart/form-data","X-CSRFToken":C()},onUploadProgress:e=>{const t=Math.round(100*e.loaded/e.total);k(t)}});if(t.data.error)throw new Error(t.data.error);alert("File uploaded successfully!");const s={id:t.data.id,title:t.data.title,type:l,file_url:t.data.file_url,sender:t.data.sender,uploaded_at:(new Date).toISOString(),originalExtension:i};o((e=>[s,...e])),h(null),x(""),S(!1),k(0),D()}catch(c){alert("Error uploading file: "+c.message),S(!1),k(0)}},T=async e=>{if(e&&e.type&&e.id)try{if(!window.confirm("Are you sure you want to delete this file?"))return;if(e.isDeleting)return;o((t=>t.map((t=>t.id===e.id?{...t,isDeleting:!0}:t))));let t="";switch(e.type){case"document":t=`/files/private/documents/${e.id}/`;break;case"image":t=`/files/private/images/${e.id}/`;break;case"audio":t=`/files/private/audio/${e.id}/`;break;case"video":t=`/files/private/video/${e.id}/`;break;default:return}if(204===(await a.delete(t,{headers:{"X-CSRFToken":C()}})).status){const t=t=>t.filter((t=>t.id!==e.id));o((e=>{const a=t(e);return d(t(n)),a}))}else alert("Failed to delete the file."),o((t=>t.map((t=>t.id===e.id?{...t,isDeleting:!1}:t))))}catch(t){alert("Error deleting the file. Please try again."),o((t=>t.map((t=>t.id===e.id?{...t,isDeleting:!1}:t))))}};return y?e.jsxs("div",{className:"file-dashboard-container mt-20 mb-2",children:[e.jsx("h1",{className:"dashboard-title",children:e.jsxs("div",{className:"flex items-center ml-20",children:[e.jsx("div",{className:"w-24 h-24 relative mr-6",children:e.jsx(r,{src:null==y?void 0:y.profile_picture,userName:null==y?void 0:y.first_name})}),j?`${j}'s Dashboard`:"File Dashboard",e.jsx("div",{className:"flex items-center pl-40 italic",children:e.jsx("p",{className:"text-lg",children:"(INSTRUCTIONS: Here you can exchange general files with your teacher)"})})]})}),e.jsxs("div",{className:"dashboard-content",children:[e.jsxs("aside",{className:"sidebar",children:[e.jsxs("div",{className:"upload-form",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Upload File"}),e.jsxs("form",{onSubmit:F,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Title:"}),e.jsx("input",{type:"text",value:v,onChange:e=>x(e.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"File:"}),e.jsx("input",{type:"file",onChange:e=>h(e.target.files[0]),className:"mt-1 block w-full",required:!0})]}),$&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:e.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full transition-all duration-300",style:{width:`${_}%`}})}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Uploading: ",_,"%"]})]}),e.jsx("button",{type:"submit",disabled:$,className:"w-full py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white \n                    "+($?"bg-gray-400 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-700"),children:$?"Uploading...":"Upload File"})]})]}),e.jsx(l,{filters:c,setFilters:u})]}),e.jsx("main",{className:"file-list",children:n.length>0?n.map(((t,i)=>{const l=t.uniqueKey||`${t.id}-${t.type||"unknown"}-${i}`;return e.jsx(s,{file:t,onDownload:()=>(async(e,t,i)=>{var s,l,r;try{let s;switch(i){case"document":s=`/files/private/documents/${e}/download/`;break;case"image":s=`/files/private/images/${e}/download/`;break;case"audio":s=`/files/private/audio/${e}/download/`;break;case"video":s=`/files/private/video/${e}/download/`;break;default:throw new Error("Unknown file type")}const l=await a.get(s,{responseType:"blob",headers:{"X-CSRFToken":C()}}),r=l.headers["content-type"],o=l.headers["content-disposition"];let n=t;const d=o&&/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(o);d&&d[1]&&(n=d[1].replace(/['"]/g,"")),n.includes("/")&&(n=n.split("/").pop(),n=decodeURIComponent(n));const c=new Blob([l.data],{type:r}),u=window.URL.createObjectURL(c),m=document.createElement("a");m.href=u,m.setAttribute("download",n),document.body.appendChild(m),m.click(),document.body.removeChild(m),window.URL.revokeObjectURL(u)}catch(o){let e="Error downloading file. ";404===(null==(s=o.response)?void 0:s.status)?e+="File not found.":403===(null==(l=o.response)?void 0:l.status)?e+="You do not have permission to download this file.":500===(null==(r=o.response)?void 0:r.status)?e+="Server error. Please try again later.":e+="Please try again.",alert(e)}})(t.id,t.title,t.type),onDelete:T},l)})):e.jsx("p",{className:"no-files-message",children:"No files match your filters."})})]}),"teacher"===(null==y?void 0:y.user_type)&&e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{htmlFor:"studentSelect",className:"block text-sm font-medium text-gray-700 mb-1",children:"Select Dashboard to View"}),e.jsxs("select",{id:"studentSelect",onChange:e=>{const t=m.find((t=>t.id===Number(e.target.value)));b(Number(e.target.value)),N(t?`${t.first_name} ${t.last_name}`:"")},value:g||"",className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md",children:[y&&e.jsx("option",{value:y.id,children:"My Dashboard"}),m.filter((e=>e&&e.id&&e.first_name&&e.last_name)).map((t=>e.jsx("option",{value:t.id,children:`${t.first_name} ${t.last_name}`},t.id)))]})]})]}):e.jsx("div",{children:"Loading dashboard or user not authenticated..."})};export{o as default};
