import{j as e}from"./mui-vendor-BMRJiz3v.js";import{r as s,u as r}from"./react-vendor-CYXGpHdp.js";import{a as t}from"./index-DaNyzoGW.js";import"./utils-BB-Y_vZ-.js";const l=({src:r,userName:l,className:a=""})=>{const[o,i]=s.useState(!1),[n,d]=s.useState(!0),c=(null==r?void 0:r.includes("#preview"))?r.replace("#preview",""):(null==r?void 0:r.startsWith("http"))?r:r?`${t.defaults.baseURL}${r}`:null;return s.useEffect((()=>{if(i(!1),d(!0),!c)return i(!0),void d(!1);const e=new Image;return e.onload=()=>{d(!1),i(!1)},e.onerror=e=>{i(!0),d(!1)},e.src=c,()=>{e.onload=null,e.onerror=null,(null==r?void 0:r.includes("#preview"))&&URL.revokeObjectURL(c)}}),[c,r]),o||!c?e.jsx("div",{className:`w-full h-full rounded-full bg-gradient-to-br from-blue-100 to-blue-200 flex items-center justify-center text-blue-500 border-4 border-white shadow-xl ${a}`,children:e.jsx("svg",{className:"w-12 h-12",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}):e.jsxs("div",{className:"relative w-full h-full",children:[n&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 rounded-full",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}),e.jsx("img",{src:c,alt:`${l}'s profile`,className:`w-full h-full rounded-full object-cover border-4 border-white shadow-xl ${n?"opacity-0":"opacity-100"} transition-opacity duration-300 ${a}`,onError:()=>i(!0)})]})},a=()=>{s.useEffect((()=>{window.scrollTo(0,0)}),[]),r();const[a,o]=s.useState(null),[i,n]=s.useState(""),[d,c]=s.useState("");s.useState(0);const[u,m]=s.useState([]),[p,b]=s.useState(""),[x,h]=s.useState({first_name:"",last_name:"",email:"",telephone:"",bio:"",user_type:"STUDENT"}),g=50;s.useEffect((()=>{(async()=>{try{const e=await t.get("/users/me/");if(200===e.status){const s=e.data;h(s),s.profile_picture_url?n(s.profile_picture_url):s.profile_picture&&n(s.profile_picture);try{const e=JSON.parse(s.bio);e.goals&&Array.isArray(e.goals)&&m(e.goals),e.notes&&h((s=>({...s,bio:e.notes})))}catch{h(s)}}}catch(e){c("Error loading profile data")}})()}),[]);const f=e=>{if(null==e||e.preventDefault(),p.trim()){if(u.length>=g)return void c("No puedes añadir más de 50 objetivos. Considera completar o eliminar algunos primero.");m([...u,{text:p.trim(),completed:!1}]),b(""),c("")}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-blue-100 py-10 px-4 mt-16",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl p-8 shadow-xl border border-white/50",children:[e.jsxs("div",{className:"flex flex-col items-center mb-8",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"w-32 h-32 relative z-10",children:e.jsx(l,{src:i,userName:x.first_name})}),e.jsxs("label",{className:"absolute bottom-0 right-0 bg-blue-500 text-white p-2 rounded-full shadow-lg cursor-pointer transform transition-transform hover:scale-110 z-20",children:[e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]}),e.jsx("input",{type:"file",onChange:e=>{const s=e.target.files[0];if(s){if(!s.type.startsWith("image/"))return void c("Please select an image file");if(s.size>5242880)return void c("Image size should be less than 5MB");o(s);const e=URL.createObjectURL(s);n(e+"#preview"),c("")}},className:"hidden"})]})]}),e.jsxs("h2",{className:"mt-4 text-2xl font-bold text-gray-800",children:[x.first_name," ",x.last_name]}),e.jsx("span",{className:"px-3 py-1 text-sm text-blue-600 bg-blue-100 rounded-full mt-2",children:x.user_type})]}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),c("");try{const e=new FormData;Object.keys(x).forEach((s=>{["profile_picture","profile_picture_url"].includes(s)||e.append(s,x[s])})),a&&e.append("profile_picture",a);const r=JSON.stringify({goals:u,notes:x.bio||""});e.append("bio",r);const l=await t.put("/users/me/",e,{headers:{"Content-Type":"multipart/form-data"}});if(200===l.status){const e=l.data;if(e.profile_picture){const s=e.profile_picture.startsWith("http")?e.profile_picture:`${t.defaults.baseURL}${e.profile_picture}`,r=new Image;r.onload=()=>{n(s),o(null)},r.onerror=()=>{n(oldPreview)},r.src=s}try{const s=JSON.parse(e.bio);m(s.goals||[]),h((r=>({...r,...e,bio:s.notes||""})))}catch(s){h((s=>({...s,...e})))}c("Profile updated successfully")}else c("Failed to update profile. Please try again.")}catch(s){c("Error updating profile. Please try again.")}},className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"first_name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre"}),e.jsx("input",{id:"first_name",value:x.first_name,onChange:e=>h({...x,first_name:e.target.value}),placeholder:"Introduce tu nombre",required:!0,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"last_name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Apellidos"}),e.jsx("input",{id:"last_name",value:x.last_name,onChange:e=>h({...x,last_name:e.target.value}),placeholder:"Introduce tus apellidos",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:["Email ",e.jsx("span",{className:"text-sm text-gray-500",children:"(No editable)"})]}),e.jsx("input",{id:"email",value:x.email,readOnly:!0,disabled:!0,className:"w-full p-3 bg-gray-100 border border-gray-300 rounded-lg text-gray-500 cursor-not-allowed"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"telephone",className:"block text-sm font-medium text-gray-700 mb-1",children:"Teléfono"}),e.jsx("input",{id:"telephone",value:x.telephone,onChange:e=>h({...x,telephone:e.target.value}),placeholder:"Introduce tu teléfono",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Mis objetivos de aprendizaje",e.jsx("span",{className:"block text-xs text-gray-500 mt-1",children:"Marca las casillas cuando alcances tus objetivos"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:p,onChange:e=>b(e.target.value),onKeyPress:e=>"Enter"===e.key&&f(e),placeholder:"Añadir nuevo objetivo...",className:"flex-1 p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:u.length>=g}),e.jsx("button",{onClick:f,type:"button",className:"px-4 py-2 text-white rounded-lg transition-colors "+(u.length>=g?"bg-gray-400 cursor-not-allowed":"bg-blue-500 hover:bg-blue-600"),disabled:u.length>=g,children:"Añadir"})]}),e.jsx("div",{className:"mt-2 text-sm text-gray-500",children:u.length>0&&e.jsxs("span",{children:[u.length," de ",g," objetivos añadidos"]})}),e.jsx("div",{className:"pb-4"}),e.jsx("div",{className:"space-y-2 max-h-[400px] overflow-y-auto bg-gray-50 p-4 rounded-lg",children:0===u.length?e.jsx("p",{className:"text-gray-500 text-center text-sm",children:"No hay objetivos añadidos aún"}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"sticky top-0 bg-gray-50 pb-2 mb-2 border-b border-gray-200",children:e.jsxs("div",{className:"flex justify-between text-sm text-gray-500",children:[e.jsxs("span",{children:["Completados: ",u.filter((e=>e.completed)).length]}),e.jsxs("span",{children:["Pendientes: ",u.filter((e=>!e.completed)).length]})]})}),u.map(((s,r)=>e.jsxs("div",{className:"flex items-center gap-2 bg-white p-3 rounded-lg shadow-sm border border-gray-100 hover:border-blue-200 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:s.completed,onChange:()=>(e=>{const s=[...u];s[e].completed=!s[e].completed,m(s)})(r),className:"w-5 h-5 text-blue-600 rounded border-gray-300 focus:ring-blue-500"}),e.jsx("span",{className:"flex-1 "+(s.completed?"line-through text-gray-400":"text-gray-700"),children:s.text}),e.jsx("button",{onClick:()=>(e=>{m(u.filter(((s,r)=>r!==e)))})(r),className:"text-gray-400 hover:text-red-500 transition-colors p-1",title:"Eliminar objetivo",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]},r)))]})})]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"bio",className:"block text-sm font-medium text-gray-700 mb-1",children:["Mis notas personales",e.jsx("span",{className:"block text-xs text-gray-500 mt-1",children:"Este espacio es personal - solo tú puedes verlo. Utilízalo para tus notas adicionales y reflexiones."})]}),e.jsx("textarea",{id:"bio",value:x.bio,onChange:e=>h({...x,bio:e.target.value}),placeholder:"Escribe aquí tus notas personales...",rows:"4",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"})]})]}),e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx("button",{type:"submit",className:"w-full md:w-auto px-8 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors",children:"Guardar cambios"}),d&&e.jsx("div",{className:"w-full p-3 rounded-lg text-sm text-center "+("Profile updated successfully"===d?"bg-green-100 text-green-700 border border-green-200":"bg-red-100 text-red-700 border border-red-200"),children:d})]})]})]})})})},o=()=>e.jsx(e.Fragment,{children:e.jsx(a,{})});export{o as default};
