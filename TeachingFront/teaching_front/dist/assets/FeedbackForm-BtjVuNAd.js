import{j as e,B as t,C as a,T as l,a as s,b as n,M as r}from"./mui-vendor-Ch3u1txE.js";import{u as i,r as o}from"./react-vendor-CYnrZ62f.js";import{u as d,a as u}from"./index-z-z7bop-.js";import"./utils-Bon0u5qF.js";const c=()=>{const e="csrftoken=",t=decodeURIComponent(document.cookie).split(";");for(let a of t)if(a=a.trim(),0===a.indexOf(e))return a.substring(10,a.length);return null},p=()=>{const p=i(),[m,h]=o.useState(null),[x,f]=o.useState(""),[v,g]=o.useState([]),[b,y]=o.useState(""),[j,w]=o.useState(""),[S]=o.useState([{value:"Cambridge",label:"Cambridge"},{value:"Aptis",label:"Aptis"},{value:"EOI",label:"Escuela Oficial de Idiomas"},{value:"IELTS",label:"Ielts"},{value:"Trinity",label:"Trinity"},{value:"(Homework task)",label:"Homework Task"},{value:"(Essay)",label:"Essay"},{value:"(Project)",label:"Project"},{value:"*Other*",label:"Other"}]),[_,C]=o.useState(""),[k,F]=o.useState(""),[E,P]=o.useState(null),[T,W]=o.useState(null),[D,I]=o.useState(""),[O,U]=o.useState(""),[A,B]=o.useState(null),[H,R]=o.useState(null);o.useState(null);const[z,G]=o.useState(""),[L,M]=o.useState(null),[q,N]=o.useState(!0),[X,$]=o.useState(null),[J,K]=o.useState(!1),[Q,V]=o.useState(!1),{user:Y}=d(),Z="teacher"===(null==Y?void 0:Y.user_type);o.useEffect((()=>{(async()=>{var e;try{(await u.get("/users/check-auth/")).data.logged_in||p("/login")}catch(t){401===(null==(e=t.response)?void 0:e.status)&&p("/login")}})()}),[p]);o.useEffect((()=>{(async()=>{try{N(!0);const e=(await u.get("/users/me/")).data;M(e.id),h(e),f(e.username||""),G(e.name||e.username||"Unknown Student")}catch(e){$("Failed to load user profile")}finally{N(!1)}})()}),[]),o.useEffect((()=>{m&&(async()=>{try{const e=(await u.get("/users/all-users/")).data.map((e=>({id:e.id,username:e.username,name:e.first_name?`${e.first_name} ${e.last_name}`:e.username,user_type:e.user_type}))),t=e.filter((e=>"student"===e.user_type)),a=e.filter((e=>"teacher"===e.user_type));g("teacher"===(null==m?void 0:m.user_type)?t:a)}catch(e){$("Failed to load users list")}})()}),[m]),o.useEffect((()=>{if(_&&k){const e=_/k*100;P(e.toFixed(2)),W((e/10).toFixed(1))}}),[_,k]);const ee=()=>{y(""),w(""),C(""),F(""),P(null),W(null),I(""),U(""),B(null),R(null),$(null),V(!1)};return q?e.jsx(t,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh",children:e.jsx(a,{})}):X?e.jsx(t,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh",children:e.jsx(l,{color:"error",children:X})}):e.jsxs(t,{sx:{width:"100%",maxWidth:"100vw",overflow:"hidden",p:{xs:2,sm:4,md:6},mt:"80px"},children:[e.jsx(s,{onClick:()=>{p("/landing")},variant:"outlined",sx:{mb:2},children:"Back to Landing Page"}),e.jsx(l,{variant:"h4",component:"h1",gutterBottom:!0,sx:{mb:4},children:"teacher"===(null==m?void 0:m.user_type)?"Teacher Feedback Form":"Student Assignment Upload"}),e.jsxs(t,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:4,maxWidth:"1400px",mx:"auto",px:{xs:1,sm:2,md:4}},children:[e.jsxs(t,{component:"form",onSubmit:async e=>{if(e.preventDefault(),V(!0),$(null),!L)return alert("User ID not found. Please log in again."),void V(!1);try{if(!b)throw new Error("teacher"===(null==m?void 0:m.user_type)?"Please select a student":"Please select a teacher");if(!j)throw new Error("Please select a task type");if(!A)throw new Error("Please upload a document");const e=new FormData;e.append("document_area",A),e.append("student_name","teacher"===(null==m?void 0:m.user_type)?b:L.toString()),e.append("send_to",b),e.append("task_type",j),Z?(O&&e.append("teacher_notes",O),_&&e.append("grade_awarded",_),k&&e.append("grade_total",k)):D&&e.append("student_notes",D);for(let[a,l]of e.entries())File;const t=await u.post("/api/upload/",e,{headers:{"Content-Type":"multipart/form-data","X-CSRFToken":c()}});if(t.data.error)throw new Error(t.data.error);K(!0),alert("Feedback submitted successfully!"),ee()}catch(t){$(t.message||"An error occurred while submitting the feedback.")}finally{V(!1)}},sx:{flex:1,minWidth:{xs:"100%",sm:"380px"},maxWidth:{sm:"45%"}},children:[e.jsx(n,{select:!0,label:"teacher"===(null==m?void 0:m.user_type)?"Select Student":"Select Teacher",value:b,onChange:e=>y(e.target.value),fullWidth:!0,required:!0,sx:{mb:2.5},children:v.map((t=>e.jsx(r,{value:t.id,children:t.username},t.id)))}),e.jsx(n,{select:!0,label:"Task Type",value:j,onChange:e=>w(e.target.value),fullWidth:!0,required:!0,sx:{mb:2.5},children:S.map((t=>e.jsx(r,{value:t.value,children:t.label},t.value)))}),"teacher"===(null==m?void 0:m.user_type)&&e.jsxs(e.Fragment,{children:[e.jsx(n,{label:"Grade Awarded",type:"number",value:_,onChange:e=>C(e.target.value),fullWidth:!0,sx:{mb:2.5}}),e.jsx(n,{label:"Total Grade",type:"number",value:k,onChange:e=>F(e.target.value),fullWidth:!0,sx:{mb:2.5}}),_&&k&&e.jsxs(t,{sx:{mb:2.5,p:2,bgcolor:"background.paper",borderRadius:1,border:"1px solid",borderColor:"divider"},children:[e.jsxs(l,{variant:"body1",gutterBottom:!0,children:["Grade Percentage: ",E,"%"]}),e.jsxs(l,{variant:"body1",children:["Spanish Grade: ",T," / 10"]})]}),e.jsx(n,{label:"Teacher Notes",multiline:!0,rows:4,value:O,onChange:e=>U(e.target.value),fullWidth:!0,sx:{mb:2.5}})]}),"student"===(null==m?void 0:m.user_type)&&e.jsx(n,{label:"Student Notes",multiline:!0,rows:4,value:D,onChange:e=>I(e.target.value),fullWidth:!0,sx:{mb:2.5}}),e.jsxs(t,{sx:{mb:2.5},children:[e.jsx("input",{accept:".pdf,.doc,.docx,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document",style:{display:"none"},id:"document-upload",type:"file",onChange:e=>{const t=e.target.files[0];if(t){if(t.size>26214400)return alert("File size too large. Maximum size allowed is 25MB."),void(e.target.value="");if(!["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(t.type))return alert("Invalid file type. Please upload a PDF, DOC, or DOCX file."),void(e.target.value="");B(t),"application/pdf"===t.type?R(URL.createObjectURL(t)):R(null)}}}),e.jsx("label",{htmlFor:"document-upload",children:e.jsx(s,{variant:"contained",component:"span",children:"Upload Document"})}),A&&e.jsxs(l,{variant:"body2",sx:{mt:1},children:["Selected file: ",A.name]})]}),e.jsx(s,{type:"submit",variant:"contained",color:"primary",size:"large",fullWidth:!0,children:"Submit"})]}),e.jsx(t,{sx:{flex:1,minWidth:{xs:"100%",sm:"380px"},maxWidth:{sm:"45%"},border:"2px dashed",borderColor:"divider",borderRadius:2,p:3,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"500px",bgcolor:"background.paper"},children:A?"application/pdf"===A.type&&H?e.jsx("iframe",{src:H,width:"100%",height:"100%",style:{border:"none",minHeight:"500px"},title:"Document Preview"}):e.jsxs(t,{sx:{textAlign:"center",p:3},children:[e.jsxs(l,{variant:"h6",gutterBottom:!0,children:["File Selected: ",A.name]}),e.jsx(l,{color:"text.secondary",children:"Preview not available for this file type. File will be uploaded when you submit."})]}):e.jsx(l,{color:"text.secondary",children:"Upload a document to see preview"})})]})]})};export{p as default};
