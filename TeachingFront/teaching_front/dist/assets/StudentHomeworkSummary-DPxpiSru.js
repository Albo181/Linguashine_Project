import{j as e,B as t,C as r,T as s,a,F as i,I as n,S as o,M as l,G as d,f as c,h as x,i as h,g as u,D as f,c as p,d as g,e as m}from"./mui-vendor-BMRJiz3v.js";import{b,r as j}from"./react-vendor-CYXGpHdp.js";import{d as v}from"./Delete-CrHf_zRW.js";import{a as w}from"./index-ClGkFVQ1.js";import"./utils-BB-Y_vZ-.js";const y=b.memo((({profilePicture:t,firstName:r})=>{const[s,a]=j.useState(!1),[i,n]=j.useState(!0),o=j.useMemo((()=>{if(!t)return null;if(t.startsWith("http"))return t;const e="http://localhost:8000";return`${e.endsWith("/")?e.slice(0,-1):e}${t}`}),[t]);return j.useEffect((()=>{if(a(!1),n(!0),!o)return a(!0),void n(!1);const e=new Image;return e.onload=()=>{n(!1),a(!1)},e.onerror=e=>{a(!0),n(!1)},e.src=o,()=>{e.onload=null,e.onerror=null}}),[o]),s||!o?e.jsx("div",{className:"w-[60px] h-[60px] rounded-full bg-gradient-to-br from-blue-100 to-blue-200 flex items-center justify-center text-blue-500 border-4 border-white shadow-xl",children:e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}):e.jsxs("div",{className:"relative w-[60px] h-[60px]",children:[i&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 rounded-full",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"})}),e.jsx("img",{src:o,alt:`${r}'s profile`,className:`w-full h-full rounded-full object-cover border-4 border-white shadow-xl ${i?"opacity-0":"opacity-100"} transition-opacity duration-300`,onError:()=>a(!0)})]})})),k=()=>{j.useEffect((()=>{const e=.05*window.innerHeight;window.scrollTo(0,e)}),[]),j.useState(null);const[k,C]=j.useState([]),[_,S]=j.useState([]),[R,N]=j.useState([]),[W,D]=j.useState(1),[H,I]=j.useState(1),[L,P]=j.useState(!1),[z,F]=j.useState(null),[O,$]=j.useState(!0),[G,T]=j.useState("newest"),[E,M]=j.useState("newest"),[B,A]=j.useState(!0),[U,Y]=j.useState(null),K=b.useRef(null),V=b.useRef(null),q=e=>{var t;null==(t=e.current)||t.scrollIntoView({behavior:"smooth"})};if(j.useEffect((()=>{(async()=>{A(!0),Y(null);try{const[e,t,r]=await Promise.all([w.get("/api/student/homework/submitted/"),w.get("/api/student/homework/received/"),w.get("/users/all-users/")]);C(e.data),S(t.data),N(r.data)}catch(e){Y("Failed to load data. Please try again.")}finally{A(!1)}})()}),[]),B)return e.jsxs(t,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",flexDirection:"column",gap:2},children:[e.jsx(r,{}),e.jsx(s,{children:"Loading your homework submissions..."})]});if(U)return e.jsxs(t,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",flexDirection:"column",gap:2},children:[e.jsx(s,{color:"error",children:U}),e.jsx(a,{variant:"contained",onClick:()=>window.location.reload(),children:"Retry"})]});const J=e=>{if(!e)return"Date not available";const t=new Date(e);return isNaN(t.getTime())?"Invalid date":t.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},Q=e=>{const t=R.find((t=>t.id===e));if(t){const e=t.profile_picture_url||t.profile_picture||t.profilePicture;if(e&&e.startsWith("/media")){const t="http://localhost:8000";return`${t.endsWith("/")?t.slice(0,-1):t}${e}`}return e}return"/placeholder-profile.png"},X=(e,t=50)=>e?e.length>t?`${e.substring(0,t)}...`:e:"",Z=(e,t)=>{F(e),$(t),P(!0)},ee=()=>{P(!1),F(null)},te=async e=>{try{const t=(await w.get(e,{responseType:"blob"})).data,r=window.URL.createObjectURL(t),s=document.createElement("a");s.href=r,s.download=e.split("/").pop(),document.body.appendChild(s),s.click(),window.URL.revokeObjectURL(r),document.body.removeChild(s)}catch(t){}},re=(e,t)=>{const r=[...e];switch(t){case"oldest":return r.sort(((e,t)=>new Date(e.submission_date)-new Date(t.submission_date)));case"newest":return r.sort(((e,t)=>new Date(t.submission_date)-new Date(e.submission_date)));case"grade-high":return r.sort(((e,t)=>(t.grade_percent||0)-(e.grade_percent||0)));case"grade-low":return r.sort(((e,t)=>(e.grade_percent||0)-(t.grade_percent||0)));default:return r}};return e.jsxs(t,{sx:{padding:4,backgroundColor:"#f9f9f9",minHeight:"100vh"},children:[e.jsx(s,{variant:"h4",sx:{mb:4,textAlign:"center"},children:"Student Dashboard"}),e.jsxs(t,{ref:K,sx:{backgroundColor:"#f0f7ff",borderRadius:"8px",p:3,mb:6,boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},children:[e.jsx(t,{sx:{display:"flex",justifyContent:"center",mb:3},children:e.jsx(a,{onClick:()=>q(V),sx:{backgroundColor:"#ff9800",color:"white",fontWeight:"bold","&:hover":{backgroundColor:"#f57c00"}},children:"↓ Sent"})}),e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(s,{variant:"h5",sx:{display:"flex",alignItems:"center","&::before":{content:'""',display:"block",width:"4px",height:"24px",backgroundColor:"#1976d2",marginRight:"12px",borderRadius:"2px"}},children:"Received Work"}),e.jsxs(i,{sx:{minWidth:200},children:[e.jsx(n,{children:"Sort By"}),e.jsxs(o,{value:E,onChange:e=>{M(e.target.value),D(1)},label:"Sort By",size:"small",children:[e.jsx(l,{value:"newest",children:"Newest First"}),e.jsx(l,{value:"oldest",children:"Oldest First"}),e.jsx(l,{value:"grade-high",children:"Grade (High to Low)"}),e.jsx(l,{value:"grade-low",children:"Grade (Low to High)"})]})]})]}),e.jsx(d,{container:!0,spacing:3,children:(e=>{const t=9*(W-1);return e.slice(t,t+9)})(re(_,E)).map((r=>{var i,n,o,l;return e.jsx(d,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(c,{sx:{height:"100%",display:"flex",flexDirection:"column",borderRadius:"8px",backgroundColor:"#fafafa",background:"linear-gradient(45deg, #fafafa 25%, #ffffff 25%, #ffffff 50%, #fafafa 50%, #fafafa 75%, #ffffff 75%, #ffffff 100%)",backgroundSize:"40px 40px",backgroundOpacity:.3,border:"0.5px solid #eaeaea","&:hover":{transform:"translateY(-4px)",boxShadow:"0 12px 24px rgba(0,0,0,0.07)",transition:"all 0.3s ease"},transition:"all 0.3s ease"},children:[e.jsxs(x,{sx:{flexGrow:1,p:2},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(y,{profilePicture:Q(null==(i=r.send_to)?void 0:i.id),firstName:null==(n=r.send_to)?void 0:n.first_name}),e.jsxs(t,{sx:{ml:2},children:[e.jsx(s,{variant:"h6",sx:{fontWeight:600,lineHeight:1.2},children:r.task_type}),e.jsxs(s,{variant:"caption",color:"text.secondary",children:["From: ",null==(o=r.send_to)?void 0:o.first_name," ",null==(l=r.send_to)?void 0:l.last_name]})]})]}),null!==r.grade_awarded&&e.jsxs(s,{variant:"body1",sx:{color:"#2196f3",fontWeight:500,mt:1,mb:2,backgroundColor:"rgba(33, 150, 243, 0.1)",padding:"4px 8px",borderRadius:"4px",display:"inline-block"},children:["Grade: ",r.grade_awarded,"/",r.grade_total," (",(r.grade_awarded/r.grade_total*100).toFixed(1),"%)"]}),r.teacher_notes&&e.jsxs(t,{sx:{mt:1},children:[e.jsx(s,{variant:"caption",color:"text.secondary",sx:{fontWeight:500},children:"Teacher Notes:"}),e.jsx(s,{variant:"body2",sx:{backgroundColor:"#e3f2fd",padding:"8px 12px",borderRadius:"4px",whiteSpace:"pre-wrap",maxHeight:"60px",overflow:"auto",border:"1px solid rgba(33, 150, 243, 0.1)",boxShadow:"0 1px 3px rgba(0,0,0,0.05)"},children:X(r.teacher_notes,100)})]}),e.jsxs(s,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:1},children:["Received: ",J(r.submission_date)]})]}),e.jsxs(h,{sx:{p:2,pt:0},children:[e.jsx(a,{size:"small",variant:"contained",onClick:()=>te(r.document_area),children:"Download"}),e.jsx(u,{size:"small",onClick:()=>Z(r.id,!0),color:"error",children:e.jsx(v,{})})]})]})},r.id)}))}),e.jsxs(t,{sx:{mt:4,textAlign:"center"},children:[e.jsx(a,{variant:"outlined",onClick:()=>D((e=>Math.max(e-1,1))),disabled:1===W,children:"Previous"}),e.jsxs(s,{variant:"body1",sx:{display:"inline",mx:2},children:["Page ",W]}),e.jsx(a,{variant:"outlined",onClick:()=>D((e=>e+1)),disabled:9*W>=_.length,children:"Next"})]})]}),e.jsx(t,{sx:{my:6,height:"2px",background:"linear-gradient(to right, rgba(25, 118, 210, 0.1), rgba(25, 118, 210, 0.5), rgba(25, 118, 210, 0.1))",position:"relative"},children:e.jsx(s,{variant:"overline",sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"#fff",padding:"0 16px",color:"#666",fontWeight:500},children:"HOMEWORK SECTIONS"})}),e.jsxs(t,{ref:V,sx:{backgroundColor:"#fff8f0",borderRadius:"8px",p:3,mb:4,boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},children:[e.jsx(t,{sx:{display:"flex",justifyContent:"center",mb:3},children:e.jsx(a,{onClick:()=>q(K),sx:{backgroundColor:"#2196f3",color:"white",fontWeight:"bold","&:hover":{backgroundColor:"#1976d2"}},children:"↑ Received"})}),e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(s,{variant:"h5",sx:{display:"flex",alignItems:"center","&::before":{content:'""',display:"block",width:"4px",height:"24px",backgroundColor:"#ffb74d",marginRight:"12px",borderRadius:"2px"}},children:"Sent Work"}),e.jsxs(i,{sx:{minWidth:200},children:[e.jsx(n,{children:"Sort By"}),e.jsxs(o,{value:G,onChange:e=>{T(e.target.value),I(1)},label:"Sort By",size:"small",children:[e.jsx(l,{value:"newest",children:"Newest First"}),e.jsx(l,{value:"oldest",children:"Oldest First"}),e.jsx(l,{value:"grade-high",children:"Grade (High to Low)"}),e.jsx(l,{value:"grade-low",children:"Grade (Low to High)"})]})]})]}),e.jsx(d,{container:!0,spacing:3,children:(e=>{const t=9*(H-1);return e.slice(t,t+9)})(re(k,G)).map((r=>{var i,n,o,l;return e.jsx(d,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(c,{sx:{height:"100%",display:"flex",flexDirection:"column",borderRadius:"8px",backgroundColor:"#fafafa",background:"linear-gradient(45deg, #fafafa 25%, #ffffff 25%, #ffffff 50%, #fafafa 50%, #fafafa 75%, #ffffff 75%, #ffffff 100%)",backgroundSize:"40px 40px",backgroundOpacity:.3,border:"0.5px solid #eaeaea","&:hover":{transform:"translateY(-4px)",boxShadow:"0 12px 24px rgba(0,0,0,0.07)",transition:"all 0.3s ease"},transition:"all 0.3s ease"},children:[e.jsxs(x,{sx:{flexGrow:1,p:2},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(y,{profilePicture:Q(null==(i=r.student_name)?void 0:i.id),firstName:null==(n=r.student_name)?void 0:n.first_name}),e.jsxs(t,{sx:{ml:2},children:[e.jsx(s,{variant:"h6",sx:{fontWeight:600,lineHeight:1.2},children:r.task_type}),e.jsxs(s,{variant:"caption",color:"text.secondary",children:["To: ",null==(o=r.send_to)?void 0:o.first_name," ",null==(l=r.send_to)?void 0:l.last_name]})]})]}),r.student_notes&&e.jsxs(t,{sx:{mt:1},children:[e.jsx(s,{variant:"caption",color:"text.secondary",sx:{fontWeight:500},children:"Your Notes:"}),e.jsx(s,{variant:"body2",sx:{backgroundColor:"#f5f5f5",padding:"8px 12px",borderRadius:"4px",whiteSpace:"pre-wrap",maxHeight:"60px",overflow:"auto",border:"1px solid rgba(0,0,0,0.05)",boxShadow:"0 1px 3px rgba(0,0,0,0.05)"},children:X(r.student_notes,100)})]}),e.jsxs(s,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:1},children:["Sent: ",J(r.submission_date)]})]}),e.jsxs(h,{sx:{p:2,pt:0},children:[e.jsx(a,{size:"small",variant:"contained",onClick:()=>te(r.document_area),children:"Download"}),e.jsx(u,{size:"small",onClick:()=>Z(r.id,!1),color:"error",children:e.jsx(v,{})})]})]})},r.id)}))}),e.jsxs(t,{sx:{mt:4,textAlign:"center"},children:[e.jsx(a,{variant:"outlined",onClick:()=>I((e=>Math.max(e-1,1))),disabled:1===H,children:"Previous"}),e.jsxs(s,{variant:"body1",sx:{display:"inline",mx:2},children:["Page ",H]}),e.jsx(a,{variant:"outlined",onClick:()=>I((e=>e+1)),disabled:9*H>=k.length,children:"Next"})]})]}),e.jsxs(f,{open:L,onClose:ee,"aria-labelledby":"delete-dialog-title",children:[e.jsx(p,{id:"delete-dialog-title",children:"Hide Submission"}),e.jsx(g,{children:e.jsx(s,{children:"Are you sure you want to hide this submission? It will be removed from your view but will still be visible to the teacher."})}),e.jsxs(m,{children:[e.jsx(a,{onClick:ee,color:"primary",children:"Cancel"}),e.jsx(a,{onClick:async()=>{z&&(await(async(e,t)=>{try{const r=t?`/api/student/homework/received/${e}/`:`/api/student/homework/submitted/${e}/`,s=await w.delete(r);204!==s.status&&200!==s.status||(t?S((t=>t.filter((t=>t.id!==e)))):C((t=>t.filter((t=>t.id!==e)))))}catch(r){Y("Failed to hide submission. Please try again."),setTimeout((()=>Y(null)),3e3)}})(z,O),P(!1),F(null))},color:"primary",variant:"contained",children:"Hide"})]})]})]})};export{k as default};
