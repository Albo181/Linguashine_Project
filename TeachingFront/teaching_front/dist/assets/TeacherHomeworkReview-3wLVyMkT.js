import{j as e,B as r,T as t,C as a,a as o,F as n,I as s,S as i,M as d,G as l,D as c,c as x,d as h,e as u,f,g as p,h as b,i as g}from"./mui-vendor-Ch3u1txE.js";import{b as m,r as j}from"./react-vendor-CYnrZ62f.js";import{a as v}from"./index-z-z7bop-.js";import"./utils-Bon0u5qF.js";const w=m.memo((({profilePicture:r,firstName:t})=>{const[a,o]=j.useState(!1),[n,s]=j.useState(!0),i=j.useMemo((()=>{if(!r)return null;if(r.startsWith("http"))return r;const e="http://localhost:8000";return`${e.endsWith("/")?e.slice(0,-1):e}${r}`}),[r]);return j.useEffect((()=>{if(o(!1),s(!0),!i)return o(!0),void s(!1);const e=new Image;return e.onload=()=>{s(!1),o(!1)},e.onerror=e=>{o(!0),s(!1)},e.src=i,()=>{e.onload=null,e.onerror=null}}),[i]),a||!i?e.jsx("div",{className:"w-[60px] h-[60px] rounded-full bg-gradient-to-br from-blue-100 to-blue-200 flex items-center justify-center text-blue-500 border-4 border-white shadow-xl",children:e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}):e.jsxs("div",{className:"relative w-[60px] h-[60px]",children:[n&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 rounded-full",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"})}),e.jsx("img",{src:i,alt:`${t}'s profile`,className:`w-full h-full rounded-full object-cover border-4 border-white shadow-xl ${n?"opacity-0":"opacity-100"} transition-opacity duration-300`,onError:()=>o(!0)})]})})),y=()=>{const[m,y]=j.useState([]),[k,C]=j.useState([]),[_,S]=j.useState([]),[R,W]=j.useState(1),[N,T]=j.useState(1),[D,I]=j.useState(!1),[L,H]=j.useState(null),[z,P]=j.useState(!0),[B,F]=j.useState("newest"),[G,$]=j.useState("newest"),[A,E]=j.useState(!0),U=j.useRef(null),M=j.useRef(null);j.useEffect((()=>{const e=.05*window.innerHeight;window.scrollTo(0,e)}),[]);j.useEffect((()=>{(async()=>{try{const[e,r,t]=await Promise.all([v.get("/api/teacher/homework/received/"),v.get("/api/teacher/homework/submitted/"),v.get("/users/all-users/")]);y(e.data),C(r.data),S(t.data),E(!1)}catch(e){E(!1)}})()}),[]);const O=e=>{if(!e)return"Date not available";const r=new Date(e);return isNaN(r.getTime())?"Invalid date":r.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},X=(e,r)=>{const t=9*(r-1);return e.slice(t,t+9)},V=()=>{I(!1),H(null)},Y=e=>{e.current&&e.current.scrollIntoView({behavior:"smooth"})},q=(e,r)=>{const t=[...e];switch(r){case"oldest":return t.sort(((e,r)=>new Date(e.submission_date)-new Date(r.submission_date)));case"newest":return t.sort(((e,r)=>new Date(r.submission_date)-new Date(e.submission_date)));case"grade-high":return t.sort(((e,r)=>{const t=e.grade_awarded?e.grade_awarded/e.grade_total*100:0;return(r.grade_awarded?r.grade_awarded/r.grade_total*100:0)-t}));case"grade-low":return t.sort(((e,r)=>(e.grade_awarded?e.grade_awarded/e.grade_total*100:0)-(r.grade_awarded?r.grade_awarded/r.grade_total*100:0)));default:return t}},J=(e,r)=>e?e.length<=r?e:e.substring(0,r)+"...":"",K=(a,n)=>{var s,i,d,l,c,x;const h=(e=>{const r=_.find((r=>r.id===e));if(r){const e=r.profile_picture_url||r.profile_picture||r.profilePicture;if(e&&e.startsWith("/media")){const r="http://localhost:8000";return`${r.endsWith("/")?r.slice(0,-1):r}${e}`}return e}return"/placeholder-profile.png"})(null==(s=a.student_name)?void 0:s.id);return e.jsxs(f,{variant:"outlined",sx:{display:"flex",flexDirection:"column",height:"100%",borderRadius:"8px",position:"relative",backgroundColor:"#fafafa",background:"linear-gradient(45deg, #fafafa 25%, #ffffff 25%, #ffffff 50%, #fafafa 50%, #fafafa 75%, #ffffff 75%, #ffffff 100%)",backgroundSize:"40px 40px",backgroundOpacity:.3,border:"0.5px solid #eaeaea",overflow:"hidden","&:hover":{transform:"translateY(-4px)",boxShadow:"0 12px 24px rgba(0,0,0,0.07)",transition:"all 0.3s ease"},transition:"all 0.3s ease"},children:[e.jsx(p,{onClick:()=>{return e=a.id,r=n,H(e),P(r),void I(!0);var e,r},sx:{position:"absolute",right:8,top:8,zIndex:3,color:"rgba(0, 0, 0, 0.54)",backgroundColor:"rgba(255, 255, 255, 0.9)","&:hover":{color:"rgba(0, 0, 0, 0.87)",backgroundColor:"rgba(255, 255, 255, 1)"},padding:"4px",minWidth:"32px",minHeight:"32px"},children:e.jsx("span",{style:{fontSize:"1.2rem",lineHeight:1},children:"×"})}),e.jsxs(b,{sx:{flexGrow:1,overflow:"hidden",p:1.5,pt:3,borderRadius:"0 0 8px 8px",position:"relative"},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",mb:1,position:"relative",zIndex:2},children:[e.jsx(w,{profilePicture:h,firstName:null==(i=a.student_name)?void 0:i.first_name}),e.jsxs(r,{sx:{ml:1},children:[e.jsx(t,{variant:"subtitle1",sx:{fontWeight:600,lineHeight:1.2},children:(null==(d=a.student_name)?void 0:d.username)||"Unknown Student"}),e.jsx(t,{variant:"caption",color:"text.secondary",sx:{display:"block"},children:null==(l=a.student_name)?void 0:l.email})]})]}),e.jsxs(t,{variant:"body2",color:"text.secondary",children:["Task: ",a.task_type]}),e.jsxs(t,{variant:"body2",color:"text.secondary",children:[n?"From:":"To:"," ",null==(c=a.student_name)?void 0:c.first_name," ",null==(x=a.student_name)?void 0:x.last_name]}),n?null!==a.grade&&void 0!==a.grade&&e.jsxs(t,{variant:"body1",sx:{color:"#2196f3",fontWeight:500,mt:1,backgroundColor:"rgba(33, 150, 243, 0.1)",padding:"4px 8px",borderRadius:"4px",display:"inline-block"},children:["Grade: ",a.grade]}):null!==a.grade_awarded&&void 0!==a.grade_awarded&&e.jsxs(t,{variant:"body1",sx:{color:"#2196f3",fontWeight:500,mt:1,backgroundColor:"rgba(33, 150, 243, 0.1)",padding:"4px 8px",borderRadius:"4px",display:"inline-block"},children:["Grade: ",a.grade_awarded,"/",a.grade_total," (",(a.grade_awarded/a.grade_total*100).toFixed(1),"%)"]}),a.student_notes&&e.jsxs(r,{sx:{mt:1},children:[e.jsx(t,{variant:"caption",color:"text.secondary",sx:{fontWeight:500},children:"Student Notes:"}),e.jsx(t,{variant:"body2",sx:{backgroundColor:"#f5f5f5",padding:"4px 8px",borderRadius:"4px",whiteSpace:"pre-wrap",maxHeight:"60px",overflow:"auto"},children:J(a.student_notes,100)})]}),!n&&a.teacher_notes&&e.jsxs(r,{sx:{mt:1},children:[e.jsx(t,{variant:"caption",color:"text.secondary",sx:{fontWeight:500},children:"Teacher Notes:"}),e.jsx(t,{variant:"body2",sx:{backgroundColor:"#e3f2fd",padding:"4px 8px",borderRadius:"4px",whiteSpace:"pre-wrap",maxHeight:"60px",overflow:"auto"},children:J(a.teacher_notes,100)})]}),e.jsxs(t,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:1},children:["Received: ",O(a.submission_date)]})]}),e.jsx(g,{sx:{pt:.5,pb:1,px:1.5},children:e.jsx(o,{size:"small",variant:"contained",onClick:()=>(async e=>{try{if(!e)return void alert("Error: No document URL available");const r=await v.get(e,{responseType:"blob",headers:{Accept:"*/*"}});let t=e.split("/").pop();const a=r.headers["content-disposition"];if(a){const e=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(a);null!=e&&e[1]&&(t=e[1].replace(/['"]/g,""))}t=decodeURIComponent(t);const o=new Blob([r.data],{type:r.headers["content-type"]||"application/octet-stream"}),n=window.URL.createObjectURL(o),s=document.createElement("a");s.href=n,s.setAttribute("download",t),document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(n)}catch(r){alert("Error downloading file. Please try again.")}})(a.document_area),sx:{textTransform:"none"},children:"Download"})})]})};return e.jsxs(r,{sx:{padding:4,backgroundColor:"#f9f9f9",minHeight:"100vh",fontFamily:"'Roboto', sans-serif"},children:[e.jsx(t,{variant:"h4",sx:{marginBottom:4,textAlign:"center",color:"#3f51b5",fontWeight:600},children:"Teacher Dashboard"}),A&&e.jsx(r,{sx:{textAlign:"center",marginTop:4},children:e.jsx(a,{})}),!A&&e.jsxs(r,{ref:U,sx:{backgroundColor:"#f0f7ff",borderRadius:"8px",p:3,mb:6,boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},children:[e.jsx(r,{sx:{display:"flex",justifyContent:"center",mb:3},children:e.jsx(o,{onClick:()=>Y(M),sx:{backgroundColor:"#ff9800",color:"white",fontWeight:"bold","&:hover":{backgroundColor:"#f57c00"}},children:"↓ Sent"})}),e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(t,{variant:"h5",sx:{display:"flex",alignItems:"center","&::before":{content:'""',display:"block",width:"4px",height:"24px",backgroundColor:"#1976d2",marginRight:"12px",borderRadius:"2px"}},children:"Received Work"}),e.jsxs(n,{sx:{minWidth:200},children:[e.jsx(s,{children:"Sort By"}),e.jsxs(i,{value:B,onChange:e=>{F(e.target.value),W(1)},label:"Sort By",size:"small",children:[e.jsx(d,{value:"newest",children:"Newest First"}),e.jsx(d,{value:"oldest",children:"Oldest First"}),e.jsx(d,{value:"grade-high",children:"Grade (High to Low)"}),e.jsx(d,{value:"grade-low",children:"Grade (Low to High)"})]})]})]}),e.jsx(l,{container:!0,spacing:3,children:X(q(m,B),R).map((r=>e.jsx(l,{item:!0,xs:12,sm:6,md:4,children:K(r,!0)},r.id)))}),e.jsxs(r,{sx:{mt:4,textAlign:"center"},children:[e.jsx(o,{variant:"outlined",onClick:()=>W((e=>Math.max(e-1,1))),disabled:1===R,sx:{textTransform:"none",borderColor:"#3f51b5",color:"#3f51b5","&:hover":{borderColor:"#2c3e50",color:"#2c3e50"}},children:"Previous"}),e.jsxs(t,{variant:"body2",sx:{marginX:2,display:"inline-block"},children:["Page ",R]}),e.jsx(o,{variant:"outlined",onClick:()=>W((e=>e+1)),disabled:m.length<=9*R,sx:{textTransform:"none",borderColor:"#3f51b5",color:"#3f51b5","&:hover":{borderColor:"#2c3e50",color:"#2c3e50"}},children:"Next"})]})]}),!A&&e.jsxs(r,{ref:M,sx:{backgroundColor:"#fff8f0",borderRadius:"8px",p:3,mb:4,boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},children:[e.jsx(r,{sx:{display:"flex",justifyContent:"center",mb:3},children:e.jsx(o,{onClick:()=>Y(U),sx:{backgroundColor:"#2196f3",color:"white",fontWeight:"bold","&:hover":{backgroundColor:"#1976d2"}},children:"↑ Received"})}),e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(t,{variant:"h5",sx:{display:"flex",alignItems:"center","&::before":{content:'""',display:"block",width:"4px",height:"24px",backgroundColor:"#ffb74d",marginRight:"12px",borderRadius:"2px"}},children:"Submitted Work"}),e.jsxs(n,{sx:{minWidth:200},children:[e.jsx(s,{children:"Sort By"}),e.jsxs(i,{value:G,onChange:e=>{$(e.target.value),T(1)},label:"Sort By",size:"small",children:[e.jsx(d,{value:"newest",children:"Newest First"}),e.jsx(d,{value:"oldest",children:"Oldest First"}),e.jsx(d,{value:"grade-high",children:"Grade (High to Low)"}),e.jsx(d,{value:"grade-low",children:"Grade (Low to High)"})]})]})]}),e.jsx(l,{container:!0,spacing:3,children:X(q(k,G),N).map((r=>e.jsx(l,{item:!0,xs:12,sm:6,md:4,children:K(r,!1)},r.id)))}),e.jsxs(r,{sx:{mt:4,textAlign:"center"},children:[e.jsx(o,{variant:"outlined",onClick:()=>T((e=>Math.max(e-1,1))),disabled:1===N,sx:{textTransform:"none",borderColor:"#3f51b5",color:"#3f51b5","&:hover":{borderColor:"#2c3e50",color:"#2c3e50"}},children:"Previous"}),e.jsxs(t,{variant:"body2",sx:{marginX:2,display:"inline-block"},children:["Page ",N]}),e.jsx(o,{variant:"outlined",onClick:()=>T((e=>e+1)),disabled:k.length<=9*N,sx:{textTransform:"none",borderColor:"#3f51b5",color:"#3f51b5","&:hover":{borderColor:"#2c3e50",color:"#2c3e50"}},children:"Next"})]})]}),e.jsxs(c,{open:D,onClose:V,"aria-labelledby":"delete-dialog-title",children:[e.jsx(x,{id:"delete-dialog-title",children:"Confirm Deletion"}),e.jsx(h,{children:e.jsx(t,{children:"Are you sure you want to delete this submission? This action cannot be undone."})}),e.jsxs(u,{children:[e.jsx(o,{onClick:V,color:"primary",children:"Cancel"}),e.jsx(o,{onClick:async()=>{L&&(await(async(e,r)=>{try{const t=r?`/api/teacher/homework/received/${e}/`:`/api/teacher/homework/submitted/${e}/`;204===(await v.delete(t)).status&&(r?y((r=>r.filter((r=>r.id!==e)))):C((r=>r.filter((r=>r.id!==e)))))}catch(t){}})(L,z),I(!1),H(null))},color:"error",variant:"contained",children:"Delete"})]})]})]})};export{y as default};
